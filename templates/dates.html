{% extends 'base.html' %}
{% load date_extras %}

{% block title %} Даты обходов {% endblock %}

{% block chapter %}
{% endblock%}

{% block content %}
<body>
<ol class="breadcrumb">
  	<li><a href='/checks/'>Обходы</a></li>
  	<li class='active'>{{ check }}</li>
</ol>
{% if error %}
<div class="alert alert-warning">
    {{ error }}
    <a class="close" data-dismiss="alert" href="#" aria-hidden="true">&times;</a>
</div>
{% endif %}
<div class="alert alert-warning" style="display: none" id='alert'>
  <a class="close" onclick="$('.alert').hide();">×</a>
  <p><strong>Внимание!</strong> Вы действительно хотите удалить обход?</p>
  <div class="alert-actions">
    <a class="btn btn-warning" id='proceed_delete'>Да</a> <a class="btn btn-default" onclick="$('.alert').hide();">Нет</a>
  </div>
</div>
<!-- кнопка нового обхода по выбранному шаблону -->
<form id='new_check_form' action='/checks/{{check.id}}/dates/new/' method='POST'>{% csrf_token %}
<strong><input class="btn btn-primary" type = 'submit' value='Обойти'></strong>
<a class="btn btn-default" href = '/checks/{{ check.id }}/tasks/'>Список заданий</a>
</form>
<form name = 'Form1' method = 'GET' target ='_top'>
	{% csrf_token %}
{% if dates.has_other_pages %}
<ul class="pagination">
  	{% if dates.has_previous %}
    	<li><a href="?page={{ dates.previous_page_number }}">&laquo;</a></li>
  	{% endif %}
  		<li>
  		<span class="current">
  		{{ dates.start_index }}-{{ dates.end_index }}
  		</span>
  		</li>
  	{% if dates.has_next %}
  		<li><a href="?page={{ dates.next_page_number }}">&raquo;</a></li>
  	{% endif %}
</ul>
{% else %}
	<br>
{% endif %}
	<table class = 'table table-hover'>
		<tr>
			<th>Дата</th>
			<th>Статус</th>
			<th></th>
		</tr>
		<!-- даты обходов -->
		{% for date in dates %}
			<tr>
				<td>
					<button type="button" class="btn btn-link" onclick="location.href='/checks/{{ date.check_id }}/{{ date.id }}/results/'">
						{{ date.date|format }}
					</button>
					</td>
				<td>
					{% if date.status == True %}
							<span class="glyphicon glyphicon-ok"></span>
						{% else %}
							<span class="glyphicon glyphicon-remove"></span>
					{% endif %}
				</td>
				<td>
          <a href='#' onclick="ondelete{{ date.id }}({{ date.id }})"><span class="glyphicon glyphicon-trash"></span></a>
          <script>
          function ondelete{{ date.id }}(date_id){
            $('#proceed_delete').attr('href','/checks/{{ date.check_id }}/{{ date.id }}/delete/');
            $('.alert').show();
          }
          </script>
				</td>
			</tr>		
		{% endfor %}
	</table>
</form>
</body>

{% endblock %}